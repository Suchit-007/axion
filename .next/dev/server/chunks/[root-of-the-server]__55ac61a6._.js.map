{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 58, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Projects/Sprintx_hack/src/lib/db.ts"],"sourcesContent":["import mongoose from 'mongoose';\r\n\r\nlet MONGODB_URI = process.env.MONGODB_URI || 'mongodb://localhost:27017/maintenance-platform';\r\n\r\nif (!MONGODB_URI) {\r\n  throw new Error('Please define the MONGODB_URI environment variable');\r\n}\r\n\r\n// Ensure database name is in the connection string\r\n// MongoDB Atlas connection strings sometimes don't include database name\r\nif (MONGODB_URI.includes('mongodb+srv://') || MONGODB_URI.includes('mongodb://')) {\r\n  // Check if database name is missing (connection string ends with / or has ? but no database)\r\n  const hasQueryParams = MONGODB_URI.includes('?');\r\n  const pathMatch = MONGODB_URI.match(/@[^\\/]+(\\/[^?]*)?(\\?|$)/);\r\n  \r\n  if (!pathMatch || !pathMatch[1] || pathMatch[1] === '/') {\r\n    // Database name is missing, add it\r\n    const dbName = 'maintenance-platform';\r\n    if (hasQueryParams) {\r\n      // Insert database name before query params\r\n      MONGODB_URI = MONGODB_URI.replace(/(@[^\\/]+)\\/?(?=\\?)/, `$1/${dbName}`);\r\n    } else {\r\n      // Append database name at the end\r\n      if (MONGODB_URI.endsWith('/')) {\r\n        MONGODB_URI = MONGODB_URI + dbName;\r\n      } else {\r\n        MONGODB_URI = MONGODB_URI + '/' + dbName;\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\ninterface MongooseCache {\r\n  conn: typeof mongoose | null;\r\n  promise: Promise<typeof mongoose> | null;\r\n}\r\n\r\ndeclare global {\r\n  var mongoose: MongooseCache | undefined;\r\n}\r\n\r\nlet cached: MongooseCache = global.mongoose || {\r\n  conn: null,\r\n  promise: null,\r\n};\r\n\r\nif (!global.mongoose) {\r\n  global.mongoose = cached;\r\n}\r\n\r\nasync function connectDB() {\r\n  if (cached.conn) {\r\n    return cached.conn;\r\n  }\r\n\r\n  if (!cached.promise) {\r\n    const opts = {\r\n      bufferCommands: false,\r\n    };\r\n\r\n    try {\r\n      cached.promise = mongoose.connect(MONGODB_URI, opts);\r\n    } catch (error) {\r\n      cached.promise = null;\r\n      console.error('MongoDB connection setup error:', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  try {\r\n    cached.conn = await cached.promise;\r\n    console.log('MongoDB connected successfully');\r\n    return cached.conn;\r\n  } catch (error: any) {\r\n    cached.promise = null;\r\n    console.error('MongoDB connection error:', error.message);\r\n    throw new Error(`Failed to connect to MongoDB: ${error.message}`);\r\n  }\r\n}\r\n\r\nexport default connectDB;\r\n\r\n"],"names":[],"mappings":";;;;AAAA;;AAEA,IAAI,cAAc,QAAQ,GAAG,CAAC,WAAW,IAAI;AAE7C,IAAI,CAAC,aAAa;IAChB,MAAM,IAAI,MAAM;AAClB;AAEA,mDAAmD;AACnD,yEAAyE;AACzE,IAAI,YAAY,QAAQ,CAAC,qBAAqB,YAAY,QAAQ,CAAC,eAAe;IAChF,6FAA6F;IAC7F,MAAM,iBAAiB,YAAY,QAAQ,CAAC;IAC5C,MAAM,YAAY,YAAY,KAAK,CAAC;IAEpC,IAAI,CAAC,aAAa,CAAC,SAAS,CAAC,EAAE,IAAI,SAAS,CAAC,EAAE,KAAK,KAAK;QACvD,mCAAmC;QACnC,MAAM,SAAS;QACf,IAAI,gBAAgB;YAClB,2CAA2C;YAC3C,cAAc,YAAY,OAAO,CAAC,sBAAsB,CAAC,GAAG,EAAE,QAAQ;QACxE,OAAO;YACL,kCAAkC;YAClC,IAAI,YAAY,QAAQ,CAAC,MAAM;gBAC7B,cAAc,cAAc;YAC9B,OAAO;gBACL,cAAc,cAAc,MAAM;YACpC;QACF;IACF;AACF;AAWA,IAAI,SAAwB,OAAO,QAAQ,IAAI;IAC7C,MAAM;IACN,SAAS;AACX;AAEA,IAAI,CAAC,OAAO,QAAQ,EAAE;IACpB,OAAO,QAAQ,GAAG;AACpB;AAEA,eAAe;IACb,IAAI,OAAO,IAAI,EAAE;QACf,OAAO,OAAO,IAAI;IACpB;IAEA,IAAI,CAAC,OAAO,OAAO,EAAE;QACnB,MAAM,OAAO;YACX,gBAAgB;QAClB;QAEA,IAAI;YACF,OAAO,OAAO,GAAG,oHAAQ,CAAC,OAAO,CAAC,aAAa;QACjD,EAAE,OAAO,OAAO;YACd,OAAO,OAAO,GAAG;YACjB,QAAQ,KAAK,CAAC,mCAAmC;YACjD,MAAM;QACR;IACF;IAEA,IAAI;QACF,OAAO,IAAI,GAAG,MAAM,OAAO,OAAO;QAClC,QAAQ,GAAG,CAAC;QACZ,OAAO,OAAO,IAAI;IACpB,EAAE,OAAO,OAAY;QACnB,OAAO,OAAO,GAAG;QACjB,QAAQ,KAAK,CAAC,6BAA6B,MAAM,OAAO;QACxD,MAAM,IAAI,MAAM,CAAC,8BAA8B,EAAE,MAAM,OAAO,EAAE;IAClE;AACF;uCAEe"}},
    {"offset": {"line": 128, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Projects/Sprintx_hack/src/models/User.ts"],"sourcesContent":["import mongoose, { Schema, Document } from 'mongoose';\r\n\r\nexport interface IUser extends Document {\r\n  email: string;\r\n  name: string;\r\n  password: string;\r\n  role: 'student' | 'staff' | 'technician' | 'admin';\r\n  phone?: string;\r\n  location?: string;\r\n  isActive: boolean;\r\n  createdAt: Date;\r\n  updatedAt: Date;\r\n}\r\n\r\nconst UserSchema: Schema = new Schema(\r\n  {\r\n    email: { \r\n      type: String, \r\n      required: true, \r\n      unique: true,\r\n      lowercase: true,\r\n      trim: true\r\n    },\r\n    name: { \r\n      type: String, \r\n      required: true \r\n    },\r\n    password: { \r\n      type: String, \r\n      required: true \r\n    },\r\n    role: { \r\n      type: String, \r\n      enum: ['student', 'staff', 'technician', 'admin'],\r\n      default: 'student'\r\n    },\r\n    phone: { \r\n      type: String \r\n    },\r\n    location: { \r\n      type: String \r\n    },\r\n    isActive: { \r\n      type: Boolean, \r\n      default: true \r\n    }\r\n  },\r\n  { \r\n    timestamps: true \r\n  }\r\n);\r\n\r\nexport default mongoose.models.User || mongoose.model<IUser>('User', UserSchema);\r\n\r\n"],"names":[],"mappings":";;;;AAAA;;AAcA,MAAM,aAAqB,IAAI,mHAAM,CACnC;IACE,OAAO;QACL,MAAM;QACN,UAAU;QACV,QAAQ;QACR,WAAW;QACX,MAAM;IACR;IACA,MAAM;QACJ,MAAM;QACN,UAAU;IACZ;IACA,UAAU;QACR,MAAM;QACN,UAAU;IACZ;IACA,MAAM;QACJ,MAAM;QACN,MAAM;YAAC;YAAW;YAAS;YAAc;SAAQ;QACjD,SAAS;IACX;IACA,OAAO;QACL,MAAM;IACR;IACA,UAAU;QACR,MAAM;IACR;IACA,UAAU;QACR,MAAM;QACN,SAAS;IACX;AACF,GACA;IACE,YAAY;AACd;uCAGa,oHAAQ,CAAC,MAAM,CAAC,IAAI,IAAI,oHAAQ,CAAC,KAAK,CAAQ,QAAQ"}},
    {"offset": {"line": 178, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Projects/Sprintx_hack/src/app/api/auth/register/route.ts"],"sourcesContent":["import { NextResponse } from 'next/server';\r\nimport bcrypt from 'bcryptjs';\r\nimport connectDB from '@/lib/db';\r\nimport User from '@/models/User';\r\n\r\nexport async function POST(request: Request) {\r\n  try {\r\n    const { name, email, password, phone, role } = await request.json();\r\n\r\n    if (!name || !email || !password) {\r\n      return NextResponse.json(\r\n        { message: 'Name, email, and password are required' },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    // Connect to MongoDB\r\n    try {\r\n      await connectDB();\r\n    } catch (dbError: any) {\r\n      console.error('Database connection error:', dbError);\r\n      return NextResponse.json(\r\n        { \r\n          message: 'Database connection failed',\r\n          error: process.env.NODE_ENV === 'development' ? dbError.message : undefined\r\n        },\r\n        { status: 500 }\r\n      );\r\n    }\r\n\r\n    // Check if user already exists\r\n    try {\r\n      const existingUser = await User.findOne({ email: email.toLowerCase() });\r\n      if (existingUser) {\r\n        return NextResponse.json(\r\n          { message: 'User already exists with this email' },\r\n          { status: 400 }\r\n        );\r\n      }\r\n    } catch (queryError: any) {\r\n      console.error('User query error:', queryError);\r\n      return NextResponse.json(\r\n        { \r\n          message: 'Error checking existing user',\r\n          error: process.env.NODE_ENV === 'development' ? queryError.message : undefined\r\n        },\r\n        { status: 500 }\r\n      );\r\n    }\r\n\r\n    // Hash password\r\n    let hashedPassword: string;\r\n    try {\r\n      hashedPassword = await bcrypt.hash(password, 12);\r\n    } catch (hashError: any) {\r\n      console.error('Password hashing error:', hashError);\r\n      return NextResponse.json(\r\n        { message: 'Error hashing password' },\r\n        { status: 500 }\r\n      );\r\n    }\r\n\r\n    // Create user\r\n    try {\r\n      const user = await User.create({\r\n        name,\r\n        email: email.toLowerCase(),\r\n        password: hashedPassword,\r\n        phone: phone || undefined,\r\n        role: role || 'student'\r\n      });\r\n\r\n      return NextResponse.json(\r\n        { \r\n          message: 'User created successfully',\r\n          user: {\r\n            id: user._id.toString(),\r\n            name: user.name,\r\n            email: user.email,\r\n            role: user.role\r\n          }\r\n        },\r\n        { status: 201 }\r\n      );\r\n    } catch (createError: any) {\r\n      console.error('User creation error:', createError);\r\n      \r\n      // Handle duplicate key error\r\n      if (createError.code === 11000 || createError.name === 'MongoServerError') {\r\n        return NextResponse.json(\r\n          { message: 'User already exists with this email' },\r\n          { status: 400 }\r\n        );\r\n      }\r\n\r\n      return NextResponse.json(\r\n        { \r\n          message: 'Error creating user',\r\n          error: process.env.NODE_ENV === 'development' ? createError.message : undefined\r\n        },\r\n        { status: 500 }\r\n      );\r\n    }\r\n  } catch (error: any) {\r\n    console.error('Registration error:', error);\r\n    return NextResponse.json(\r\n      { \r\n        message: 'Internal server error',\r\n        error: process.env.NODE_ENV === 'development' ? error.message : undefined\r\n      },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}\r\n\r\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;AACA;;;;;AAEO,eAAe,KAAK,OAAgB;IACzC,IAAI;QACF,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,QAAQ,EAAE,KAAK,EAAE,IAAI,EAAE,GAAG,MAAM,QAAQ,IAAI;QAEjE,IAAI,CAAC,QAAQ,CAAC,SAAS,CAAC,UAAU;YAChC,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,SAAS;YAAyC,GACpD;gBAAE,QAAQ;YAAI;QAElB;QAEA,qBAAqB;QACrB,IAAI;YACF,MAAM,IAAA,6HAAS;QACjB,EAAE,OAAO,SAAc;YACrB,QAAQ,KAAK,CAAC,8BAA8B;YAC5C,OAAO,gJAAY,CAAC,IAAI,CACtB;gBACE,SAAS;gBACT,OAAO,uCAAyC,QAAQ,OAAO,GAAG;YACpE,GACA;gBAAE,QAAQ;YAAI;QAElB;QAEA,+BAA+B;QAC/B,IAAI;YACF,MAAM,eAAe,MAAM,kIAAI,CAAC,OAAO,CAAC;gBAAE,OAAO,MAAM,WAAW;YAAG;YACrE,IAAI,cAAc;gBAChB,OAAO,gJAAY,CAAC,IAAI,CACtB;oBAAE,SAAS;gBAAsC,GACjD;oBAAE,QAAQ;gBAAI;YAElB;QACF,EAAE,OAAO,YAAiB;YACxB,QAAQ,KAAK,CAAC,qBAAqB;YACnC,OAAO,gJAAY,CAAC,IAAI,CACtB;gBACE,SAAS;gBACT,OAAO,uCAAyC,WAAW,OAAO,GAAG;YACvE,GACA;gBAAE,QAAQ;YAAI;QAElB;QAEA,gBAAgB;QAChB,IAAI;QACJ,IAAI;YACF,iBAAiB,MAAM,8IAAM,CAAC,IAAI,CAAC,UAAU;QAC/C,EAAE,OAAO,WAAgB;YACvB,QAAQ,KAAK,CAAC,2BAA2B;YACzC,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,SAAS;YAAyB,GACpC;gBAAE,QAAQ;YAAI;QAElB;QAEA,cAAc;QACd,IAAI;YACF,MAAM,OAAO,MAAM,kIAAI,CAAC,MAAM,CAAC;gBAC7B;gBACA,OAAO,MAAM,WAAW;gBACxB,UAAU;gBACV,OAAO,SAAS;gBAChB,MAAM,QAAQ;YAChB;YAEA,OAAO,gJAAY,CAAC,IAAI,CACtB;gBACE,SAAS;gBACT,MAAM;oBACJ,IAAI,KAAK,GAAG,CAAC,QAAQ;oBACrB,MAAM,KAAK,IAAI;oBACf,OAAO,KAAK,KAAK;oBACjB,MAAM,KAAK,IAAI;gBACjB;YACF,GACA;gBAAE,QAAQ;YAAI;QAElB,EAAE,OAAO,aAAkB;YACzB,QAAQ,KAAK,CAAC,wBAAwB;YAEtC,6BAA6B;YAC7B,IAAI,YAAY,IAAI,KAAK,SAAS,YAAY,IAAI,KAAK,oBAAoB;gBACzE,OAAO,gJAAY,CAAC,IAAI,CACtB;oBAAE,SAAS;gBAAsC,GACjD;oBAAE,QAAQ;gBAAI;YAElB;YAEA,OAAO,gJAAY,CAAC,IAAI,CACtB;gBACE,SAAS;gBACT,OAAO,uCAAyC,YAAY,OAAO,GAAG;YACxE,GACA;gBAAE,QAAQ;YAAI;QAElB;IACF,EAAE,OAAO,OAAY;QACnB,QAAQ,KAAK,CAAC,uBAAuB;QACrC,OAAO,gJAAY,CAAC,IAAI,CACtB;YACE,SAAS;YACT,OAAO,uCAAyC,MAAM,OAAO,GAAG;QAClE,GACA;YAAE,QAAQ;QAAI;IAElB;AACF"}}]
}